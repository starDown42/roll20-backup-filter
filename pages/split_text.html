<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>PDF 텍스트 → Markdown 파서</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<style>
body { padding:20px; }
textarea { height:280px; font-family:monospace; }
pre {
  background:#f8f9fa;
  padding:16px;
  white-space:pre-wrap;
  word-break:break-word;
}
</style>
</head>
<body>

<div class="container">
  <h3 class="mb-3">PDF 텍스트 → Markdown 구조 변환기</h3>

  <textarea id="input" class="form-control mb-3"
    placeholder="PDF 전체 텍스트를 그대로 붙여넣으십시오."></textarea>

  <button id="parse" class="btn btn-primary mb-2">가공 시작</button>
  <button id="copy" class="btn btn-success mb-2">전체 복사</button>

  <pre id="output"></pre>
</div>

<script>
$(function(){

  $("#parse").click(function(){

    const lines = $("#input").val().split(/\r?\n/);

    let pages = [];
    let buffer = [];
    let currentMain = "";

    for(let i=0; i<lines.length; i++){
      const line = lines[i];

      const pageMatch = line.trim().match(/^(\d{3})\s*P$/);
      if(pageMatch){

        const page = pageMatch[1] + " P";

        const main = buffer.length ? buffer.pop().trim() : currentMain;
        const sub  = (i+1 < lines.length) ? lines[i+1].trim() : "";

        if(main) currentMain = main;

        const body = buffer.join("\n").trim();

        pages.push({
          main: currentMain,
          page,
          sub,
          body
        });

        buffer = [];
        i++; // 소분류 줄 스킵
        continue;
      }

      buffer.push(line);
    }

    let out = "";
    let lastMain = "";

    pages.forEach(p => {

      if(p.main && p.main !== lastMain){
        out += "# " + p.main + "\n\n";
        lastMain = p.main;
      }

      out += "### " + p.page + " " + p.sub + "\n\n";
      if(p.body) out += p.body + "\n\n";
    });

    $("#output").text(out.trim());
  });

  $("#copy").click(function(){
    const text = $("#output").text();
    if(!text) return;
    navigator.clipboard.writeText(text).then(() => alert("복사 완료"));
  });

});
</script>

</body>
</html>
