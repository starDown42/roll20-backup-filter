<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CCF í…ìŠ¤íŠ¸ ì¶”ì¶œ</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="../style.css" rel="stylesheet">
	<script src="https://unpkg.com/prettier@3.0.0/standalone.js"></script>
	<script src="https://unpkg.com/prettier@3.0.0/plugins/html.js"></script>
	<style>
		#title::after {
			content: 'ì—…ë¡œë“œ íŒŒì¼ì˜ ê²½ìš°, [https://sukenell.github.io/cclog_custom/] ì‚¬ì´íŠ¸ì—ì„œ ê°€ê³µí•œ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤.';
			font-size: 1rem;
			display: inline-block;
			margin-left: 10px;
			color: #777;
		}
	</style>
</head>

<body class="container py-4">
	<h2 class="mb-3 text-center"><a class="hometitle" href="../index.html">ORPG ë°±ì—… ì„œí¬íŠ¸</a></h2>
	<hr class="my-4">
	<h3 class="mb-3">CCF í…ìŠ¤íŠ¸ ì¶”ì¶œ</h3>
	<hr class="my-4">
	<div>
		<h4 class="mb-3" id="title">HTML íŒŒì¼ ì—…ë¡œë“œ</h4>
		<input type="file" id="fileInput" accept=".html" class="form-control mb-3">
		<button onclick="extractDialogue()" class="btn btn-success">í…ìŠ¤íŠ¸ ì¶”ì¶œ</button>
	</div>
	<hr class="my-4">
	<textarea id="output" class="form-control" rows="10" readonly></textarea>

	<script>
		const prettierConfig = {
			arrowParens: "always",
			bracketSameLine: false,
			objectWrap: "preserve",
			bracketSpacing: true,
			semi: true,
			experimentalOperatorPosition: "end",
			experimentalTernaries: false,
			singleQuote: true,
			jsxSingleQuote: false,
			quoteProps: "as-needed",
			trailingComma: "all",
			singleAttributePerLine: false,
			htmlWhitespaceSensitivity: "css",
			vueIndentScriptAndStyle: false,
			proseWrap: "preserve",
			insertPragma: false,
			printWidth: 9999,
			requirePragma: false,
			tabWidth: 4,
			useTabs: true,
			embeddedLanguageFormatting: "off",
		};


		async function extractDialogue() {
			const fileInput = document.getElementById('fileInput');
			if (!fileInput.files.length) return alert('HTML íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');

			const reader = new FileReader();
			reader.onload = async function (event) { // âœ… async ì¶”ê°€
				const parser = new DOMParser();
				const oriDoc = parser.parseFromString(event.target.result, 'text/html');

				// ğŸ”¹ Prettierë¥¼ ì´ìš©í•œ í¬ë§·íŒ…
				const formattedHtml = await prettier.format(event.target.result, { // âœ… await ì •ìƒ ì ìš©
					parser: "html",
					plugins: [prettierPlugins.html],
					...prettierConfig, // âœ… ì»¤ìŠ¤í…€ ì„¤ì • ì ìš©
				});

				// ğŸ”¹ ë‹¤ì‹œ HTMLë¡œ ë³€í™˜ (ì¤‘ìš”!)
				const doc = parser.parseFromString(formattedHtml, 'text/html');

				let output = '';

				doc.querySelectorAll('.gap').forEach(gap => {
					let spans = gap.querySelectorAll('p span');
					
					// ì´ë¦„ë¦„
					let nameParts = [];
					// ğŸ”¹ ì²« ë²ˆì§¸ ìš”ì†Œê°€ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ "[ì²« ë²ˆì§¸ ìš”ì†Œ]"
					if (spans[0].textContent.trim()) {
						nameParts.push(`[${spans[0].textContent.trim()}]`);
					}
					// ğŸ”¹ ë‘ ë²ˆì§¸ ìš”ì†Œë¶€í„° ë§ˆì§€ë§‰ì„ ì œì™¸í•œ ìš”ì†Œë“¤ì„ ëª¨ë‘ í•©ì¹¨
					for (let i = 1; i < spans.length - 1; i++) {
						let text = spans[i].textContent.trim();
						if (text) nameParts.push(text);
					}
					const name = nameParts.join(' '); // ìµœì¢… ì´ë¦„ êµ¬ì„±

					// ëŒ€ì‚¬
					let textElem = spans[spans.length - 1]; // ë§ˆì§€ë§‰ span
					const text = textElem.textContent.trim();

					if (name && text) {
						output += `${name}::\t${text}\n`;
					}
				});

				document.getElementById('output').value = output;
			};
			reader.readAsText(fileInput.files[0]);
		}

	</script>
</body>

</html>